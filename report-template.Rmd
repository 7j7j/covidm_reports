---
author: "LSHTM CMMID COVID-19 Working Group"
date: "`r format(Sys.Date(),'%d %b %Y')`"
output:
  bookdown::pdf_document2:
    fig_caption: yes
    toc: false
    citation_package: natbib
    latex_engine: xelatex
mainfont: Arial
geometry:
 - top=10mm
 - left=12mm
 - right=12mm
 - bottom=15mm
params:
  location: Default
  unmitigated: "`r data.frame()`"
  peaks: "`r data.frame()`"
  accs: "`r data.frame()`"
  alls: "`r data.frame()`"
  contactmatrices: "`r matrix()`"
  poppyra: "`r integer()`"
  plothelpers: "`r character()`"
  is_analogy: "`r NA_character_`"
title: "`r sprintf('Modelling projections for COVID-19 epidemic in %s', params$location)`"
bibliography: COVID.bib
header-includes:
  - \usepackage{booktabs}
  - \usepackage{longtable}
  - \usepackage{array}
  - \usepackage{multirow}
  - \usepackage{wrapfig}
  - \usepackage{float}
  - \usepackage{colortbl}
  - \usepackage{pdflscape}
  - \usepackage{tabu}
  - \usepackage{threeparttable}
  - \usepackage[normalem]{ulem}
  - \usepackage{makecell}
  - \usepackage[round]{natbib}
  - \newcommand{\blandscape}{\begin{landscape}}
  - \newcommand{\elandscape}{\end{landscape}}
editor_options: 
  chunk_output_type: console
---
```{r echo=FALSE, include=FALSE}
knitr::opts_chunk$set(echo=FALSE, warning=FALSE, message=FALSE)
```

```{r echo=FALSE, include=FALSE}
suppressPackageStartupMessages({
  require(data.table)
  require(ggplot2)
  require(ggthemr)
  require(cowplot)
  require(knitr)
  require(tidyverse)
  require(RColorBrewer)
  require(kableExtra)
})

for (ph in params$plothelpers) {
  if (grepl("rda$", ph)) {
    load(ph)
  } else if (grepl("R$", ph)) {
    source(ph)
  }
}

alls.dt <- params$alls[scen_id %in% c(1,scens)]

milestones <- c(90,180,270)
```

<!-- Seems a bit weird to scroll to page 2 with the space on page 1, could fill that space with key results bullets maybe as above -->
<!-- Why don't you have a lockdown or curfew scenario, which have been implemented in many places? Or is e.g. the most severe restrictions standing in for that? Going back to who is reading this, the question I am left with is "how do I get to 80% shielding and 40% distancing" - can I get to 40% distancing just by a curfew? -->

<!-- Following on from Matt's comments I think the interventions may need to be spelled out a bit more. i.e. shielding, this intervention is aimed at protecting the most vulnerable in society (classed as ...) and significantly reducing their contact with others. (then possibly a mention on how this may be incredibly difficult in homes of multiple occupancy. Something similar for distancing, what the 40% means specifically. -->

# Overview

- We use a stochastic age-structured dynamic transmission model to project the COVID-19 epidemic.
- Estimate predicted peak in incident symptomatic cases, deaths and daily hospital bed need.
- We show scenarios of no intervention and social distancing and shielding interventions to decrease transmission.
- Modelling methods and parameters are given at the end of the report. Parameters, including severity and hospitalisation rates, are based on global outbreak data, which have primarily been observed in Asia, Europe, and North America. These values implicitly assume risk factor rates and health service system effectiveness which may not apply generally in lower-middle income settings.
- Reports will be updated frequently as new information is included.

# Unmitigated COVID-19 Epidemic Trajectory

The panels in Fig. \@ref(fig:tsunmit) show aggregate and by-age group outcomes for daily incidence of cases and deaths, and daily demand for hospital care. The quantiles for peak timing and values for those outcomes is summarised in Table \@ref(tab:unpeakstable); Table \@ref(tab:uncumulative1) covers cumulative counts at particular milestones.

```{r}
unmit.q <- meltquantiles(params$alls[scen_id == 1])
unmit.q$age <- factor(
  unmit.q$age, levels = levels(unmit.q$age)[c(6,1:5)],
  ordered = T
)
unmit.pks <- params$alls[scen_id == 1][,{
  res <- apply(.SD, 2, max)
  names(res) <- colnames(.SD)
  as.list(res)
}, by=.(compartment, age, scen_id)]
unmit.pks$age <- factor(
  unmit.pks$age, levels = levels(unmit.pks$age)[c(6,1:5)],
  ordered = T
)
quotepeaks <- unmit.pks[age == "all"]
rngprint <- function(r, prefix="") {
  ifelse(round(r[1])==round(r[2]),as.character(round(r[1])), sprintf("%s%i-%i",prefix,round(r[1]), round(r[2])))
}
bullettext <- function(filterdt) {
  paste0(rngprint(filterdt[,c(lo,hi)],"between ")," (95%: ",rngprint(filterdt[,c(lo.lo,hi.hi)]),")")
}
outcomesc <- params$alls[
  scen_id == 1 & age == "all"][,{
  vs <- colSums(.SD)
  names(vs) <- colnames(.SD)
  as.list(vs)
  },by=compartment,.SDcols = -c("age", "t", "scen_id")
]
outcomest <- params$alls[
  scen_id == 1 & age == "all"][,{
  vs <- t[apply(.SD, 2, which.max)]
  names(vs) <- rev(colnames(.SD))
  as.list(vs)
  },by=compartment,.SDcols = -c("age", "t", "scen_id")
]
```

In the event of unmitigated epidemic, we anticipate that:

- the incidence of symptomatic cases will peak `r bullettext(quotepeaks[compartment == "cases"])` per day, `r bullettext(outcomest[compartment == "cases"])` days from the point of 50 active infections in the community.
- the incidence of deaths will peak `r bullettext(quotepeaks[compartment == "death_o"])` per day, `r bullettext(outcomest[compartment == "death_o"])` days out
- overall hospital demand will peak `r bullettext(quotepeaks[compartment == "hosp_p"])` beds needed per day, `r bullettext(outcomest[compartment == "hosp_p"])` days out
- based on current global rates for critical and non-critical care, the demand for critical care will peak `r bullettext(quotepeaks[compartment == "icu_p"])` and non-critical care `r bullettext(quotepeaks[compartment == "nonicu_p"])`.
- the expected total number of symptomatic cases one year from the epidemic start is `r bullettext(outcomesc[compartment == "cases"])`
- the expected total number of deaths one year from the epidemic start is `r bullettext(outcomesc[compartment == "death_o"])`

\blandscape

```{r tsunmit, fig.height=6, fig.cap="Epidemics without intervention. Time series and peak sizes for incidence of symptomatic cases, incidence of deaths, general ward hospital occupancy, critical care hospital occupancy, and total hospital occupancy (general ward plus critical care). All ages is given, and separated by age group."}

age.annotate <- function(l) sprintf("%s\n%s",l,ifelse(l=="all","ages","years"))
stagger <- function(l) {
  l[seq(1,length(l),by=2)] <- sprintf("%s\n", l[seq(1,length(l),by=2)])
  l[seq(2,length(l),by=2)] <- sprintf("\n%s", l[seq(2,length(l),by=2)])
  l
}

xscale <- scale_x_t(labels = stagger, breaks = c(90, 180, 270, 360))

sharedelements <- list(
  scale_color_discrete(guide = "none"),
  scale_alpha_quantile(),
  theme_minimal(base_size = 6),
  theme(
    panel.spacing.y = unit(18, "pt")
  )
)

plot_grid(ggplotqs(unmit.q, aes(
  alpha = variable,
  color = "Unmitigated"
)) +
  facet_grid(
    compartment ~ age,
    scale = "free_y", labeller = fct_labels(
      age = age.annotate
    ),
    switch = "y"
  ) +
  sharedelements +
  xscale +
  coord_cartesian(ylim = c(0, NA), expand = F) +
  theme(
    strip.placement = "outside",
    axis.title.y = element_blank(),
    plot.margin = margin(l = 12)
  ),
int.peaks.all(unmit.pks, aes(x=age), range.scale = c(1, 1.5, 2)) + facet_grid(
  compartment ~ "\nPeak Values", scales = "free_y"
) +
  scale_x_discrete("Age Group", labels = age.annotate) +
  sharedelements +
  theme(
      axis.title.x = element_text(),
      axis.text.x = element_text(),
      axis.title.y = element_blank(),
      strip.text.y = element_blank(),
      plot.margin = margin(r=12)
    ),
  axis = "l", align = "v", rel_widths = c(3, 2)
)
```

\elandscape

```{r unpeakstable}
tabpeak <- alls.dt[scen_id == 1,{
  v.ll = max(lo.lo); t.ll = t[which.max(lo.lo)]
  v.lo = max(lo); t.lo = t[which.max(lo)]
  v.md = max(med); t.md = t[which.max(med)]
  v.hi = max(hi); t.hi = t[which.max(hi)]
  v.hh = max(hi.hi); t.hh = t[which.max(hi.hi)]
  .(
    t=sprintf("%i-%i (%i-%i)", round(t.hi), round(t.lo), round(t.hh), round(t.ll)),
    v=sprintf("%i-%i (%i-%i)", round(v.lo), round(v.hi), round(v.ll), round(v.hh))
  )},
  by=.(age, compartment)
][,.(
  Outcome=c(
    cases="Incident Cases",
    death_o="Incident Deaths",
    hosp_p="Total Hospital Occupancy",
    nonicu_p="Non-critical Occupancy",
    icu_p="Critical Occupancy"
  )[as.character(compartment)],
  `Age Group`=sprintf("%s %s",as.character(age),ifelse(age=="all","ages","years")),
  `Peak Day, IQR (95% interval)`=t,
  `Peak Number, IQR (95% interval)`=v
)]
collapse_rows(kable(tabpeak, caption="Peak timing and values for various outcomes in the unmitigated scenario, by age group. Timing is from the date of ongoing community spread with 50 infections."))
```

```{r uncumulative1}
outcome_cumulative <- c(
    cases="Cases",
    death_o="Deaths",
    hosp_p="Total Hospital Bed-Days",
    nonicu_p="Non-critical Bed-Days",
    icu_p="Critical Bed-Days"
  )

unmitacc <- params$unmitigated[
  order(t),.(t, value=cumsum(value)),by=.(run, age, compartment)
][t %in% milestones,{
  qs <- quantile(value, probs = refprobs)
  iqr <- rngprint(qs[c(2,4)])
  i95 <- rngprint(qs[c(1,5)])
  sprintf("%s (%s)", iqr, i95)
},by=.(age, compartment, t)]

unmitacctable1 <- dcast(unmitacc, age + compartment ~ t, value.var="V1")[
order(compartment, age),.(
  Outcome=outcome_cumulative[as.character(compartment)],
  `Age Group`=sprintf("%s %s",as.character(age),ifelse(age=="all","ages","years")),
  `3 months`=`90`,
  `6 months`=`180`,
  `9 months`=`270`
)
]

# unmitacctable2 <- dcast(unmitacc, age + compartment ~ t, value.var="V1")[
# order(compartment, age),.(
#   Outcome=outcome_cumulative[as.character(compartment)],
#   `Age Group`=sprintf("%s %s",as.character(age),ifelse(age=="all","ages","years")),
#   `1 year`=`360`
# )
# ]

landscape(collapse_rows(
  kable(unmitacctable1, caption="Cumulative counts for various outcomes in the unmitigated scenario, by age group; counts are evaluated at 3, 6, and 9 months."),
  columns = 1
))
```

# Intervention Scenarios

The panels in Fig. \@ref(fig:tsintervention) compare epidemics without intervention with 5 different potential interventions. The quantiles for peak timing and values for those outcomes is summarised in Table \@ref(tab:intpeakstable); Table \@ref(tab:intcumulative1) covers cumulative reductions due to the interventions at particular milestones.

- We assumed these interventions are applied at the country level.
- General physical distancing was implemented as a reduction in transmission for all contacts outside the household. We assumed no change in transmission within the household, despite some potential benefits (e.g., improved WASH compliance).
- Shielding was implemented by stratifying the population in one shielded and one unshielded compartment. In the presence of shielding, mixing between the shielded and unshielded population reduces by some degree. To be effective, sheilding must be maintained until the epidemic is over and must ensure that there is not increased mixing amongst the sheilded population.
```{r}
effref <- params$accs[metric == "effectiveness" & age == "all" & t == 360 & scen_id %in% scens]
colnames(effref)[5:9] <- c("lo.lo","lo","med","hi","hi.hi")
redref <- params$accs[metric == "reduction" & age == "all" & t == 360 & scen_id %in% scens]
colnames(redref)[5:9] <- c("lo.lo","lo","med","hi","hi.hi")
#redref[, longname := int.factorize(scen_id) ]
efftext <- function(r) {
  v <- round(r*100)
  sprintf("%i-%i%% (95%%: %i-%i%%)",v[2],v[4],v[1],v[5])
}
intbulltext <- function(sid, cmp) {
  paste0(bullettext(redref[scen_id == sid & compartment == cmp]),"; % reduction: ", efftext(effref[scen_id == sid & compartment == cmp,c(lo.lo,lo,med,hi,hi.hi)]))
}
```
The total and % net reduction to cases, deaths, and hospitalised person-days in these scenarios, one year after the general community transmission starts, is:

 - 20% distancing:
   - cases reduced by `r intbulltext(7, "cases")`
   - deaths reduced by `r intbulltext(7, "death_o")`
   - hospitalised bed-days reduced by `r intbulltext(7, "hosp_p")`
 - 40% distancing:
   - cases reduced by `r intbulltext(9, "cases")`
   - deaths reduced by `r intbulltext(9, "death_o")`
   - hospitalised bed-days reduced by `r intbulltext(9, "hosp_p")`
 - 80% sheilding:
   - cases reduced by `r intbulltext(20, "cases")`
   - deaths reduced by `r intbulltext(20, "death_o")`
   - hospitalised bed-days reduced by `r intbulltext(20, "hosp_p")`
 - 80% sheilding & 20% distancing:
   - cases reduced by `r intbulltext(80, "cases")`
   - deaths reduced by `r intbulltext(80, "death_o")`
   - hospitalised bed-days reduced by `r intbulltext(80, "hosp_p")`
 - 80% sheilding & 40% distancing:
   - cases reduced by `r intbulltext(140, "cases")`
   - deaths reduced by `r intbulltext(140, "death_o")`
   - hospitalised bed-days reduced by `r intbulltext(140, "hosp_p")`


\blandscape

```{r tsintervention, fig.height=6, fig.cap="Epidemics with interventions for all ages. Time series and peak sizes for incidence of symptomatic cases, incidence of deaths, general ward hospital occupancy, critical care hospital occupancy, and total hospital occupancy (general ward plus critical care)."}
pks <- alls.dt[age=="all",{
  res <- apply(.SD, 2, max)
  names(res) <- colnames(.SD)
  as.list(res)
}, by=.(compartment, age, scen_id)]

sharedelements <- list(
  scale_alpha_quantile(),
  coord_cartesian(ylim = c(0, NA), expand = F),
  theme_minimal(base_size = 6),
  theme(
    panel.spacing.y = unit(18, "pt")
  )
)

plot_grid(
ggplotqs(meltquantiles(alls.dt[age=="all"]), aes(
   color=factor(scen_id), group=variable, alpha=variable
)) +
  facet_grid(compartment ~ scen_id, scale = "free_y", switch = "y", labeller = fct_labels(
    scen_id = { res <- levels(int.factorize(c(1, scens))); names(res) <- c(1, scens); res }
  )) +
  xscale +
  scale_color_discrete(guide = "none") +
  sharedelements +
  theme(
    strip.placement = "outside",
    axis.title.y = element_blank(),
    plot.margin = margin(l = 12)
  ),
int.peaks.all(pks, range.scale = c(1, 1.5, 2)) + facet_grid(
  compartment ~ "\nPeak Values", scales = "free_y", labeller = labeller(compartment = function(l) rep("",length(l)))
) + sharedelements +
  scale_x_discrete("\n", labels = function(bs) rep("", length(bs))) +
  theme(
      axis.title.x = element_text(),
      axis.text.x = element_text(),
      axis.title.y = element_blank(),
      legend.key.size = unit(24, "pt"),
      strip.text.y = element_blank(),
      plot.margin = margin()
    ),
  axis = "l", align = "v", rel_widths = c(3, 2)
)
```

\elandscape

```{r intpeakstable}
tabpeak <- alls.dt[age=="all",{
  v.ll = max(lo.lo); t.ll = t[which.max(lo.lo)]
  v.lo = max(lo); t.lo = t[which.max(lo)]
  v.md = max(med); t.md = t[which.max(med)]
  v.hi = max(hi); t.hi = t[which.max(hi)]
  v.hh = max(hi.hi); t.hh = t[which.max(hi.hi)]
  .(
    t=sprintf("%i-%i (%i-%i)", round(t.hi), round(t.lo), round(t.hh), round(t.ll)),
    v=sprintf("%i-%i (%i-%i)", round(v.lo), round(v.hi), round(v.ll), round(v.hh))
  )},
  by=.(scen_id, compartment)
][,.(
  Scenario=gsub(" &\n",", ",int.factorize(scen_id)),
  Outcome=c(
    cases="Incident Cases",
    death_o="Incident Deaths",
    hosp_p="Total Hospital Occupancy",
    nonicu_p="Non-critical Occupancy",
    icu_p="Critical Occupancy"
  )[as.character(compartment)],
  `Day 50% (95%)`=t,
  `Count 50% (95%)`=v
)]
collapse_rows(kable(tabpeak, caption="Peak timing and values for various outcomes, by intervention scenario. Timing is from the date of ongoing community spread with 50 infections."))
```

```{r intcumulative1}
intacc <- params$accs[metric == "reduction" & age == "all" & scen_id %in% scens][,{
  iqr <- rngprint(c(lo50,hi50))
  i95 <- rngprint(c(lo95,hi95))
  sprintf("%s (%s)", iqr, i95)
},by=.(age, compartment, t, scen_id)]

intacctable1 <- dcast(intacc, scen_id + compartment ~ t, value.var="V1")[
,.(
  Scenario=gsub(" &\n",", ",int.factorize(scen_id)),
  Outcome=outcome_cumulative[as.character(compartment)],
  `3 months`=`90`,
  `6 months`=`180`,
  `9 months`=`270`
)
]

# intacctable2 <- dcast(intacc, scen_id + compartment ~ t, value.var="V1")[
# ,.(
#   Scenario=gsub(" &\n",", ",int.factorize(scen_id)),
#   Outcome=outcome_cumulative[as.character(compartment)],
#   `1 year`=`360`
# )
# ]

landscape(collapse_rows(
  kable(intacctable1, caption="Cumulative reductions for various outcomes by intervention scenario; reductions are evaluated at 3, 6, and 9 months."), columns = 1
))
```

# Conclusions

Based on the projections, there is likely to be a large number of cases and high demand for medical care. 
Preparedness activities are needed.

# Methods, data and assumptions

We used the stochastic age-structured dynamic transmission model reported in [@davies2020].

## Dynamic transmission model 

We used a stochastic compartmental model stratified into 5-year age bands, with individuals classified according to current disease status (Fig. \@ref(fig:modelpars))) and transmission between groups based on social mixing patterns [@daviesage2020;@mossong2008social]. After infection with SARS-CoV-2 in the model, susceptible individuals pass through a latent period before becoming infectious, either with a preclinical and then clinical infection, or with a subclinical infection, before recovery or isolation. We refer to those infections causing few or no symptoms as subclinical. We assume older individuals are more likely to show clinical symptoms [@daviesage2020].

```{r modelpars, echo=FALSE, fig.height=2.5, fig.cap=sprintf("Population Structure%s", ifelse(is.na(params$is_analogy), "", paste0("; contact matrix based on ",params$is_analogy))) }
plotter <- function(pop) {
  p <- ggplot(pop) +
    aes(x = age, y = pop / 1000) +
    geom_col(fill = "#cc3366") +
    coord_flip() +
    labs(x = NULL, y = "Population (thousands)") +
    theme_minimal()
  return(p)
}
sp_contact_matrices <- function(mat, legpos = "right", is_analogy = params$is_analogy) {
  mat <- Reduce(function(l, r) l + r, mat)
  data <- data.table(reshape2::melt(mat))
  names(data) <- c("From", "To", "Contacts")
  ggplot(data) +
    geom_raster(aes(x = To, y = From, fill = Contacts)) +
    scale_fill_viridis_c() +
    theme_bw() +
    theme(
      axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5),
      strip.background = element_rect(fill = "white", colour = "white"),
      legend.position = legpos,
    )
}
plot_grid(plotter(poppyra), sp_contact_matrices(params$contactmatrices), ncol = 2)
```

## Key model parameters 

We collated multiple sources of evidence to estimate key model parameters (Table \@ref(tab:parameters)). In a meta-analysis, we estimated that the basic reproduction number, $R_0$, was 2.7 (95% credible interval: 1.6–3.9) across settings without substantial control measures in place ($R_0$ describes the average number of secondary infections caused by a typical primary infection in a completely susceptible population). We derived age-stratified case fatality ratios (CFR) to estimate a CFR that ranged substantially across age groups, from 0.1% in the 20–29 age group to 7.7% in the over-80 age group. For all model parameters, their values or distributions are given in Table \@ref(tab:parameters)
<!-- and the distributions of variable parameters are shown in Fig. \@ref(fig:parameterdistributions). -->


<!-- ```{r parameterdistributions, echo=FALSE, fig.height=8, fig.cap="Model Parameter Distributions."} -->
<!-- plot_all_parameters() -->
<!-- ``` -->


```{r echo=FALSE}
parameter_set_df <- data.frame(matrix(c(
  "Basic reproductive rate", "$R_0$", "Sampled PERT distribution", "$\\mu = 2.7$", "1.6–3.9", "References list",
  "Age-specific clinical fraction", "$y_i$", "Fixed", "Age-dependent", "0.1-0.2", "\\citep{daviesage2020}",
  "Relative infectiousness\nof subclinical cases", "$f$", "Fixed", "$0.5*y_i$", "0.1-0.5", "\\citep{daviesage2020}",
  "Case fatality ratio", "CFR", "Normal", "$\\mu = 0.5$", "0.001-0.077", "References list",
  "Serial interval", "SI", "Normal", "$\\mu = 6.5$, $\\sigma = 2.7$", "5.5-7.6 days", "\\citep{li2020early, bi2020epidemiology, nishiura2020serial}",
  "Length of preclinical period", "l", "Fixed", "30\\%", "0.3", "\\citep{liu2020contribution}",
  "Mean latent period", "p", "Fixed", "4 days", "4", "[liu2020contribution]",
  "Mean duration of\npreclinical infectiousness", "$t_p$", "Fixed", "1.5", "1.5 days", "\\citep{liu2020contribution}",
  "Mean duration of\nclinical infectiousness", "$t_c$", "Fixed", "3.5", "1.5 days", "\\citep{liu2020contribution}",
  "Mean latent period", "p", "Fixed", "4 days", "4", "\\citep{liu2020contribution}",
  "Delay from symptom\nonset to hospitilisation", "$d_h$", "Gamma", paste0("$k=7$, $\\Theta=", round(7 / 2.65^2, 2), "$"), paste0(round(qgamma(0.025, shape = 7, scale = 8 / 2.83^2)), "-", round(qgamma(0.975, shape = 7, scale = 7 / 2.65^2), 2), " days"), "\\citep{linton2020incubation, cao2020trial}",
  "Delay from hospitilisation\nto discharge/death (non-ICU)", "$d_d$", "Gamma", paste0("$k=8$, $\\Theta=", round(8 / 2.83^2, 2), "$"), paste0(round(qgamma(0.025, shape = 8, scale = 8 / 2.83^2)), "-", round(qgamma(0.975, shape = 8, scale = 8 / 2.83^2), 2), " days"), "\\citep{NHSDigital}",
  "Delay from hospitilisation\nto discharge/death (ICU)", "$d_{icu}$", "Gamma", paste0("$k=10$, $\\Theta=", round(10 / 3.16^2, 2), "$"), paste0(round(qgamma(0.025, shape = 10, scale = 3.16)), "-", round(qgamma(0.975, shape = 10, scale = 10 / 3.16^2), 2), " days"), "\\citep{cao2020trial}",
  "Delay from onset\nto death (ICU)", "$d_{tot}$", "Gamma", paste0("$k=22$, $\\Theta=", round(22 / 4.69^2, 2), "$"), paste0(round(qgamma(0.025, shape = 22, scale = 22 / 4.69^2)), "-", round(qgamma(0.975, shape = 22, scale = 22 / 4.69^2), 2), " days"), "\\citep{linton2020incubation, cao2020trial}"
),
ncol = 6, byrow = TRUE
))
names(parameter_set_df) <- c("Short English Name", "Abbrv.", "Assumed Distribution", "Distribution Parameters", "95\\% CI", "References")
parameter_set_df %>%
  # select(-References) %>%
  mutate_all(linebreak) %>%
  # mutate(References="\\citep{daviesage2020}") %>%
  # mutate(References="\\citep{liu2020contribution}") %>%
  knitr::kable("latex", booktabs = TRUE, escape = FALSE, caption = "Parameters used in the models and descriptions of their distributions and sources.", label = "parameters") %>%
  kableExtra::kable_styling(latex_options = "scale_down")
```


## Key parameters of the transmission model 

We used a serial interval of 6.5 days based on published studies [@li2020early;@bi2020epidemiology;@nishiura2020serial], and assumed that the length of the preclinical period was 30% of the total period of clinical infectiousness [@liu2020contribution]. From this, we fixed the mean of the latent period to 4 days, the mean duration of preclinical infectiousness to 1.5 days, and the mean duration of clinical infectiousness to 3.5 days. The basic reproduction number $R_0$ was estimated by synthesizing the results of a literature review (Fig. S1). For each reported value of the basic reproduction number, we matched a flexible PERT distribution (a shifted beta distribution parameterised by minimum, maximum, and mode) to the median and confidence interval reported in each study. We sampled from the resulting distributions, weighting each study equally, to obtain estimates of $R_0$ for our simulations. The age-specific clinical fraction, $y_i$, was adopted from an estimate based on case data from 6 countries [@daviesage2020], and the relative infectiousness of subclinical cases, $f$, was assumed to be 50% relative to clinical cases, as we assumed in a previous study [@daviesage2020].

## Hospital burden estimation

To calculate ICU and non-ICU beds in use through time, we scaled age-stratified symptomatic cases by age-specific hospitalisation and critical outcome probability, then summed to get the total number of hospitalised and critical cases. We then distributed hospitalised cases over time based on expected time of hospitalisation and duration admitted. We assumed gamma-distributed delays, with the shape parameter set equal to the mean, for: delay from symptom onset to hospitalisation of mean 7 days (standard deviation 2.65) [@linton2020incubation;@cao2020trial]; delay from hospitalisation to discharge / death for non-ICU patients of mean 8 days (s.d. 2.83) [@NHSDigital]; delay from hospitalisation to discharge / death for ICU patients of mean 10 days (s.d. 3.16) [@cao2020trial]; and delay from onset to death of mean 22 days (s.d. 4.69) [@linton2020incubation;@cao2020trial]. We calculated the age-specific case fatality ratio based on data from the COVID-19 outbreak in China and on the Diamond Princess cruise ship. We first calculated the naive case fatality ratio, nCFR, (i.e. deaths/cases) for each age group, then scaled down the naive CFR based on a correction factor estimated from data from the Diamond Princess [@russell2020] to give an adjusted CFR. We then calculated risk of hospitalisation based on the ratio of severe and critical cases to cases (18.5%) and deaths to cases (2.3%) in the early China data, which we took to imply 8.04 times more hospitalisations than deaths in each age group. We assumed all age groups had a 30% risk of requiring critical care if hospitalised [@cao2020trial].”

# References
